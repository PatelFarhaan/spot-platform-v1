pipeline {
    agent any

    environment {
        jenkins_filepath="scripts/load_testing/service_lookup"
    }

    stages {
        stage("Creating virtual environment") {
            steps {
                script {
                    sh """
                    cd "${env.jenkins_filepath}"
                    virtualenv venv
                    """
                }
            }
        }

        stage("Installing requirements") {
            steps {
                script {
                    sh """
                    cd "${env.jenkins_filepath}"
                    . venv/bin/activate
                    pip3 install -r requirements.txt
                    """
                }
            }
        }

        stage("Running test cases") {
            steps {
                script {
                    sh """
                    cd "${env.jenkins_filepath}"
                    . venv/bin/activate
                    python3 main.py
                    """
                }
            }
        }
    }
}
